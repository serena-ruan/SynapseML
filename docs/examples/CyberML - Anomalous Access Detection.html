<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/SynapseML/blog/rss.xml" title="Synapse ML Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/SynapseML/blog/atom.xml" title="Synapse ML Blog Atom Feed"><title data-react-helmet="true">CyberML - Anomalous Access Detection | Synapse ML</title><meta data-react-helmet="true" property="og:url" content="https://synapseml.github.io/SynapseML/docs/examples/CyberML - Anomalous Access Detection"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="0.9.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-0.9.1"><meta data-react-helmet="true" property="og:title" content="CyberML - Anomalous Access Detection | Synapse ML"><meta data-react-helmet="true" name="description" content="Here we demonstrate a novel CyberML model which can learn user access patterns and then automatically detect anomalous user access based on learned behavior."><meta data-react-helmet="true" property="og:description" content="Here we demonstrate a novel CyberML model which can learn user access patterns and then automatically detect anomalous user access based on learned behavior."><link data-react-helmet="true" rel="shortcut icon" href="/SynapseML/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://synapseml.github.io/SynapseML/docs/examples/CyberML - Anomalous Access Detection"><link data-react-helmet="true" rel="alternate" href="https://synapseml.github.io/SynapseML/docs/examples/CyberML - Anomalous Access Detection" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://synapseml.github.io/SynapseML/docs/examples/CyberML - Anomalous Access Detection" hreflang="x-default"><link rel="stylesheet" href="/SynapseML/assets/css/styles.128ff64f.css">
<link rel="preload" href="/SynapseML/assets/js/runtime~main.dc74e8c4.js" as="script">
<link rel="preload" href="/SynapseML/assets/js/main.1181f347.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1boX">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/SynapseML/"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--light_3ouy navbar__logo"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--dark_3zJb navbar__logo"><b class="navbar__title">SynapseML</b></a><a class="navbar__item navbar__link" href="/SynapseML/docs/about">Docs</a><a class="navbar__item navbar__link" href="/SynapseML/blog">Blog</a><a class="navbar__item navbar__link" href="/SynapseML/videos">Videos</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/SynapseML/docs/about">0.9.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/SynapseML/docs/next/examples/CyberML - Anomalous Access Detection">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/SynapseML/docs/examples/CyberML - Anomalous Access Detection">0.9.1</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/SynapseML/docs/examples/CyberML - Anomalous Access Detection" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">Developer Docs</a><ul class="dropdown__menu"><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Python<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/scala/com/microsoft/azure/synapse/ml/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Scala<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle displayOnlyInLargeViewport_Jf15 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_2iFN">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_2iFN">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/SynapseML/"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--light_3ouy navbar__logo"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--dark_3zJb navbar__logo"><b class="navbar__title">SynapseML</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/SynapseML/docs/about">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/SynapseML/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/SynapseML/videos">Videos</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/SynapseML/docs/next/examples/CyberML - Anomalous Access Detection">Next</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/SynapseML/docs/examples/CyberML - Anomalous Access Detection">0.9.1</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/SynapseML/docs/examples/CyberML - Anomalous Access Detection" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Developer Docs</a><ul class="menu__list"><li class="menu__list-item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Python<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/scala/com/microsoft/azure/synapse/ml/index.html" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Scala<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item"><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_3zOJ"><aside class="docSidebarContainer_G8MK"><div class="sidebar_1tWv"><nav class="menu menu--responsive thin-scrollbar menu_1Iah menuWithAnnouncementBar_3acx" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_1woU" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/SynapseML/docs/about">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/getting_started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/getting_started/first_example">First Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/getting_started/first_model">First Model</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/CognitiveServices - Overview">CognitiveServices - Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">HTTP on Spark</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/http/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/http/HttpOnSpark - Working with Arbitrary Web APIs">HttpOnSpark - Working with Arbitrary Web APIs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">LightGBM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/lightgbm/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/lightgbm/LightGBM - Overview">LightGBM - Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Model Interpretability</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/model_interpretability/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/model_interpretability/ModelInterpretability - Snow Leopard Detection">ModelInterpretability - Snow Leopard Detection</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">ONNX</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/onnx/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/onnx/ONNX - Inference on Spark">ONNX - Inference on Spark</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Spark Serving</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/spark_serving/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/spark_serving/SparkServing - Deploying a Classifier">SparkServing - Deploying a Classifier</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Vowpal Wabbit</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/vw/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/features/vw/Vowpal Wabbit - Overview">Vowpal Wabbit - Overview</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Examples</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/examples/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/examples/AzureSearchIndex - Met Artworks">AzureSearchIndex - Met Artworks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/examples/ConditionalKNN - Exploring Art Across Cultures">ConditionalKNN - Exploring Art Across Cultures</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/SynapseML/docs/examples/CyberML - Anomalous Access Detection">CyberML - Anomalous Access Detection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/examples/HyperParameterTuning - Fighting Breast Cancer">HyperParameterTuning - Fighting Breast Cancer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/examples/OpenCV - Pipeline Image Transformations">OpenCV - Pipeline Image Transformations</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Classification</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/classification/Classification - Adult Census with Vowpal Wabbit">Classification - Adult Census with Vowpal Wabbit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/classification/Classification - Adult Census">Classification - Adult Census</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/classification/Classification - Before and After SynapseML">Classification - Before and After SynapseML</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit">Classification - Twitter Sentiment with Vowpal Wabbit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Cognitive Services</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/cognitive_services/CognitiveServices - Celebrity Quote Analysis">CognitiveServices - Celebrity Quote Analysis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/cognitive_services/CognitiveServices - Predictive Maintenance">CognitiveServices - Predictive Maintenance</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Deep Learning</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/deep_learning/DeepLearning - BiLSTM Medical Entity Extraction">DeepLearning - BiLSTM Medical Entity Extraction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/deep_learning/DeepLearning - CIFAR10 Convolutional Network">DeepLearning - CIFAR10 Convolutional Network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/deep_learning/DeepLearning - Flower Image Classification">DeepLearning - Flower Image Classification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/deep_learning/DeepLearning - Transfer Learning">DeepLearning - Transfer Learning</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Model Interpretability</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/model_interpretability/Interpretability - Image Explainers">Interpretability - Image Explainers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/model_interpretability/Interpretability - Tabular SHAP explainer">Interpretability - Tabular SHAP explainer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/model_interpretability/Interpretability - Text Explainers">Interpretability - Text Explainers</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Regression</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/regression/Regression - Auto Imports">Regression - Auto Imports</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/regression/Regression - Flight Delays with DataCleaning">Regression - Flight Delays with DataCleaning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/regression/Regression - Flight Delays">Regression - Flight Delays</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/regression/Regression - Vowpal Wabbit vs. LightGBM vs. Linear Regressor">Regression - Vowpal Wabbit vs. LightGBM vs. Linear Regressor</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Text Analytics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/text_analytics/TextAnalytics - Amazon Book Reviews with Word2Vec">TextAnalytics - Amazon Book Reviews with Word2Vec</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/examples/text_analytics/TextAnalytics - Amazon Book Reviews">TextAnalytics - Amazon Book Reviews</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Transformers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/documentation/transformers/transformers_cognitive">Cognitive</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/documentation/transformers/transformers_core">Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/documentation/transformers/transformers_opencv">OpenCV</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/documentation/transformers/transformers_vw">Vowpal Wabbit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/documentation/transformers/transformers_deep_learning">Deep Learning</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Estimators</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/documentation/estimators/estimators_core">Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/documentation/estimators/estimators_lightgbm">LightGBM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/documentation/estimators/estimators_vw">Vowpal Wabbit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/reference/developer-readme">Build System Commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/reference/contributing_guide">Contributing Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/reference/docker">Docker Image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/reference/R-setup">R setup</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3Zec"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_2q91"><div class="docItemContainer_37q2"><article><span class="badge badge--secondary">Version: 0.9.1</span><div class="markdown"><header><h1 class="h1Heading_2x3C">CyberML - Anomalous Access Detection</h1></header><p>Here we demonstrate a novel CyberML model which can learn user access patterns and then automatically detect anomalous user access based on learned behavior.
The model internally uses Collaborative Filtering for Implicit Feedback as published here: <a href="http://yifanhu.net/PUB/cf.pdf" target="_blank" rel="noopener noreferrer">http://yifanhu.net/PUB/cf.pdf</a>
and is based on Apache Spark&#x27;s implementation of this: <a href="https://spark.apache.org/docs/2.2.0/ml-collaborative-filtering.html" target="_blank" rel="noopener noreferrer">https://spark.apache.org/docs/2.2.0/ml-collaborative-filtering.html</a>.</p><p>This notebook demonstrates a usage example of Anomalous Resource Access model.
All the model requires is a dataset in which there are &#x27;users&#x27; which access &#x27;resources&#x27;.
The model is based on Collaborative Filtering and it uses Machine Learning to learn access patterns of users and resources.
When a user accesses a resource which is outside of the user&#x27;s learned profile then this access recieves a high anomaly score.</p><p>In this notebook we provide a usage example and a synthetic dataset in which there are 3 departments:
(1) Finance, (2) HR and (3) Engineering.
In the training data users access only a subset of resources from their own departments.
To evaluate the model we use two datasets.
The first contains access patterns unseen during training in which users access resources within their departments (again, resources they didn&#x27;t access during training but within their department).
The latter contains users accessing resources from outside their department.
We then use the model to assign anomaly scores expecting that the first get low anomaly scores and the latter recieve high anomaly scores.
This is what this example demonstrates.</p><p>Note: the data does NOT contain information about departments, this information is implictly learned by the model by analyzing the access patterns.</p><header><h1 class="h1Heading_2x3C">Create an Azure Databricks cluster and install the following libs</h1></header><ol><li><p>In Cluster Libraries install from library source Maven:
Coordinates: com.microsoft.azure:synapseml:0.9.1
Repository: <a href="https://mmlspark.azureedge.net/maven" target="_blank" rel="noopener noreferrer">https://mmlspark.azureedge.net/maven</a></p></li><li><p>In Cluster Libraries install from PyPI the library called plotly</p></li></ol><header><h1 class="h1Heading_2x3C">Setup &amp; Initialization</h1></header><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain"># this is used to produce the synthetic dataset for this test</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">from synapse.ml.cyber.dataset import DataFactory</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># the access anomalies model generator</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">from synapse.ml.cyber.anomaly.collaborative_filtering import AccessAnomaly</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">from pyspark.sql import functions as f, types as t</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">spark.sparkContext.setCheckpointDir(&#x27;dbfs:/checkpoint_path/&#x27;)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><header><h1 class="h1Heading_2x3C">Loadup datasets</h1></header><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">factory = DataFactory(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  num_hr_users = 25,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  num_hr_resources = 50,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  num_fin_users = 35,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  num_fin_resources = 75,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  num_eng_users = 15,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  num_eng_resources = 25,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  single_component = True</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">training_pdf = factory.create_clustered_training_data(ratio=0.4)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># a tenant id is used when independant datasets originate from different tenants, in this example we set all tenants-ids to the same value</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">training_df = spark.createDataFrame(training_pdf).withColumn(&#x27;tenant_id&#x27;, f.lit(0))</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ingroup_df = spark.createDataFrame(factory.create_clustered_intra_test_data(training_pdf)).withColumn(&#x27;tenant_id&#x27;, f.lit(0))</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">outgroup_df = spark.createDataFrame(factory.create_clustered_inter_test_data()).withColumn(&#x27;tenant_id&#x27;, f.lit(0))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">training_df.show()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">print(training_df.count())</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">print(ingroup_df.count())</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">print(outgroup_df.count())</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><header><h1 class="h1Heading_2x3C">Model setup &amp; training</h1></header><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">access_anomaly = AccessAnomaly(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  tenantCol=&#x27;tenant_id&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  userCol=&#x27;user&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  resCol=&#x27;res&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  likelihoodCol=&#x27;likelihood&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  maxIter=1000</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">model = access_anomaly.fit(training_df)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><header><h1 class="h1Heading_2x3C">Apply model &amp; show result stats</h1></header><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">ingroup_scored_df = model.transform(ingroup_df)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">ingroup_scored_df.agg(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  f.min(&#x27;anomaly_score&#x27;).alias(&#x27;min_anomaly_score&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  f.max(&#x27;anomaly_score&#x27;).alias(&#x27;max_anomaly_score&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  f.mean(&#x27;anomaly_score&#x27;).alias(&#x27;mean_anomaly_score&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  f.stddev(&#x27;anomaly_score&#x27;).alias(&#x27;stddev_anomaly_score&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">).show()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">outgroup_scored_df = model.transform(outgroup_df)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">outgroup_scored_df.agg(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  f.min(&#x27;anomaly_score&#x27;).alias(&#x27;min_anomaly_score&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  f.max(&#x27;anomaly_score&#x27;).alias(&#x27;max_anomaly_score&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  f.mean(&#x27;anomaly_score&#x27;).alias(&#x27;mean_anomaly_score&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  f.stddev(&#x27;anomaly_score&#x27;).alias(&#x27;stddev_anomaly_score&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">).show()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><header><h1 class="h1Heading_2x3C">Examine results</h1></header><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">#</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># Select a subset of results to send to Log Analytics</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">#</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">full_res_df = outgroup_scored_df.orderBy(f.desc(&#x27;anomaly_score&#x27;)).cache()</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">from pyspark.sql.window import Window</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">w = Window.partitionBy(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  &#x27;tenant_id&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  &#x27;user&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  &#x27;res&#x27;  </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                ).orderBy(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  f.desc(&#x27;anomaly_score&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                )</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># select values above threshold</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">results_above_threshold = full_res_df.filter(full_res_df.anomaly_score &gt; 1.0)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># get distinct resource/user and corresponding timestamp and highest score</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">results_to_la = results_above_threshold.withColumn(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  &#x27;index&#x27;, f.row_number().over(w)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  ).orderBy(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    f.desc(&#x27;anomaly_score&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  ).select(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    &#x27;tenant_id&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    f.col(&#x27;user&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    f.col(&#x27;res&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    &#x27;anomaly_score&#x27;</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  ).where(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    &#x27;index == 1&#x27;</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  ).limit(100).cache()</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># add a fake timestamp to the results</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">results_to_la = results_to_la.withColumn(&#x27;timestamp&#x27;, f.current_timestamp())</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">display(results_to_la)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><header><h1 class="h1Heading_2x3C">Display all resource accesses by users with highest anomalous score</h1></header><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">from plotly import __version__</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">from plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot, offline</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">import numpy as np</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">import pandas as pd</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">print (__version__) # requires version &gt;= 1.9.0</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># run plotly in offline mode</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">offline.init_notebook_mode()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">#Find all server accesses of users with high predicted scores</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># For display, limit to top 25 results</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">results_to_display = results_to_la.orderBy(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  f.desc(&#x27;anomaly_score&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                ).limit(25).cache()</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">interesting_records = full_res_df.join(results_to_display, [&#x27;user&#x27;], &#x27;left_semi&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">non_anomalous_records = interesting_records.join(results_to_display, [&#x27;user&#x27;, &#x27;res&#x27;], &#x27;left_anti&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">top_non_anomalous_records = non_anomalous_records.groupBy(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          &#x27;tenant_id&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          &#x27;user&#x27;, </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          &#x27;res&#x27;</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        ).agg(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          f.count(&#x27;*&#x27;).alias(&#x27;count&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        ).select(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          f.col(&#x27;tenant_id&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          f.col(&#x27;user&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          f.col(&#x27;res&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          &#x27;count&#x27;</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        )</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">#pick only a subset of non-anomalous record for UI</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">w = Window.partitionBy(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  &#x27;tenant_id&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  &#x27;user&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                ).orderBy(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  f.desc(&#x27;count&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                )</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># pick top non-anomalous set</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">top_non_anomalous_accesses = top_non_anomalous_records.withColumn(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  &#x27;index&#x27;, f.row_number().over(w)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  ).orderBy(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    f.desc(&#x27;count&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  ).select(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    &#x27;tenant_id&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    f.col(&#x27;user&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    f.col(&#x27;res&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    f.col(&#x27;count&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  ).where(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    &#x27;index in (1,2,3,4,5)&#x27;</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  ).limit(25)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># add back anomalous record</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">fileShare_accesses = (top_non_anomalous_accesses</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          .select(&#x27;user&#x27;, &#x27;res&#x27;, &#x27;count&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                          .union(results_to_display.select(&#x27;user&#x27;, &#x27;res&#x27;, f.lit(1).alias(&#x27;count&#x27;))).cache())</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain"># get unique users and file shares</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">high_scores_df = fileShare_accesses.toPandas()</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">unique_arr = np.append(high_scores_df.user.unique(), high_scores_df.res.unique())</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">unique_df = pd.DataFrame(data = unique_arr, columns = [&#x27;name&#x27;])</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">unique_df[&#x27;index&#x27;] = range(0, len(unique_df.index))</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># create index for source &amp; target and color for the normal accesses</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">normal_line_color = &#x27;rgba(211, 211, 211, 0.8)&#x27;</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">anomolous_color = &#x27;red&#x27;</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">x = pd.merge(high_scores_df, unique_df, how=&#x27;left&#x27;, left_on=&#x27;user&#x27;, right_on=&#x27;name&#x27;).drop([&#x27;name&#x27;], axis=1).rename(columns={&#x27;index&#x27; : &#x27;userIndex&#x27;})</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">all_access_index_df = pd.merge(x, unique_df, how=&#x27;left&#x27;, left_on=&#x27;res&#x27;, right_on=&#x27;name&#x27;).drop([&#x27;name&#x27;], axis=1).rename(columns={&#x27;index&#x27; : &#x27;resIndex&#x27;})</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">all_access_index_df[&#x27;color&#x27;] = normal_line_color</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># results_to_display index, color and </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">y = results_to_display.toPandas().drop([&#x27;tenant_id&#x27;, &#x27;timestamp&#x27;, &#x27;anomaly_score&#x27;], axis=1)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">y = pd.merge(y, unique_df, how=&#x27;left&#x27;, left_on=&#x27;user&#x27;, right_on=&#x27;name&#x27;).drop([&#x27;name&#x27;], axis=1).rename(columns={&#x27;index&#x27; : &#x27;userIndex&#x27;})</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">high_scores_index_df = pd.merge(y, unique_df, how=&#x27;left&#x27;, left_on=&#x27;res&#x27;, right_on=&#x27;name&#x27;).drop([&#x27;name&#x27;], axis=1).rename(columns={&#x27;index&#x27; : &#x27;resIndex&#x27;})</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">high_scores_index_df[&#x27;count&#x27;] = 1</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">high_scores_index_df[&#x27;color&#x27;] = anomolous_color</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># substract 1 for the red entries in all_access df</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">hsi_df = high_scores_index_df[[&#x27;user&#x27;,&#x27;res&#x27;, &#x27;count&#x27;]].rename(columns={&#x27;count&#x27; : &#x27;hsiCount&#x27;})</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">all_access_updated_count_df = pd.merge(all_access_index_df, hsi_df, how=&#x27;left&#x27;, left_on=[&#x27;user&#x27;, &#x27;res&#x27;], right_on=[&#x27;user&#x27;, &#x27;res&#x27;])</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">all_access_updated_count_df[&#x27;count&#x27;] = np.where(all_access_updated_count_df[&#x27;hsiCount&#x27;]==1, all_access_updated_count_df[&#x27;count&#x27;] - 1, all_access_updated_count_df[&#x27;count&#x27;])</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">all_access_updated_count_df = all_access_updated_count_df.loc[all_access_updated_count_df[&#x27;count&#x27;] &gt; 0]</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">all_access_updated_count_df = all_access_updated_count_df[[&#x27;user&#x27;,&#x27;res&#x27;, &#x27;count&#x27;, &#x27;userIndex&#x27;, &#x27;resIndex&#x27;, &#x27;color&#x27;]]</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># combine the two tables</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">frames = [all_access_updated_count_df, high_scores_index_df]</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">display_df = pd.concat(frames, sort=True)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># display_df.head()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">data_trace = dict(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    type=&#x27;sankey&#x27;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    domain = dict(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      x =  [0,1],</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      y =  [0,1]</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    ),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    orientation = &quot;h&quot;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    valueformat = &quot;.0f&quot;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    node = dict(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      pad = 10,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      thickness = 30,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      line = dict(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        color = &quot;black&quot;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        width = 0</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      label = unique_df[&#x27;name&#x27;].dropna(axis=0, how=&#x27;any&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    ),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    link = dict(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      source = display_df[&#x27;userIndex&#x27;].dropna(axis=0, how=&#x27;any&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      target = display_df[&#x27;resIndex&#x27;].dropna(axis=0, how=&#x27;any&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      value = display_df[&#x27;count&#x27;].dropna(axis=0, how=&#x27;any&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      color = display_df[&#x27;color&#x27;].dropna(axis=0, how=&#x27;any&#x27;),</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  )</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">layout =  dict(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    title = &quot;All resources accessed by users with highest anomalous scores&quot;,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    height = 772,</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    font = dict(</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      size = 10</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    ),    </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">fig = dict(data=[data_trace], layout=layout)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">p = plot(fig, output_type=&#x27;div&#x27;)</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">displayHTML(p)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/SynapseML/docs/examples/ConditionalKNN - Exploring Art Across Cultures"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« ConditionalKNN - Exploring Art Across Cultures</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/SynapseML/docs/examples/HyperParameterTuning - Fighting Breast Cancer"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">HyperParameterTuning - Fighting Breast Cancer Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_2pwG thin-scrollbar"></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/installation">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/first_example">Getting Started</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python API Reference</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/scala/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scala API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/videos">Videos</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Microsoft.</div></div></div></footer></div>
<script src="/SynapseML/assets/js/runtime~main.dc74e8c4.js"></script>
<script src="/SynapseML/assets/js/main.1181f347.js"></script>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/SynapseML/blog/rss.xml" title="Synapse ML Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/SynapseML/blog/atom.xml" title="Synapse ML Blog Atom Feed"><title data-react-helmet="true">Classification - Twitter Sentiment with Vowpal Wabbit | Synapse ML</title><meta data-react-helmet="true" property="og:url" content="https://synapseml.github.io/SynapseML/docs/next/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Classification - Twitter Sentiment with Vowpal Wabbit | Synapse ML"><meta data-react-helmet="true" name="description" content="In this example, we show how to build a sentiment classification model using Vowpal Wabbit (VW) in SynapseML. The data set we use to train and evaluate the model is Sentiment140 twitter data. First, we import a few packages that we need."><meta data-react-helmet="true" property="og:description" content="In this example, we show how to build a sentiment classification model using Vowpal Wabbit (VW) in SynapseML. The data set we use to train and evaluate the model is Sentiment140 twitter data. First, we import a few packages that we need."><link data-react-helmet="true" rel="shortcut icon" href="/SynapseML/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://synapseml.github.io/SynapseML/docs/next/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit"><link data-react-helmet="true" rel="alternate" href="https://synapseml.github.io/SynapseML/docs/next/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://synapseml.github.io/SynapseML/docs/next/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit" hreflang="x-default"><link rel="stylesheet" href="/SynapseML/assets/css/styles.128ff64f.css">
<link rel="preload" href="/SynapseML/assets/js/runtime~main.dc74e8c4.js" as="script">
<link rel="preload" href="/SynapseML/assets/js/main.1181f347.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1boX">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/SynapseML/"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--light_3ouy navbar__logo"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--dark_3zJb navbar__logo"><b class="navbar__title">SynapseML</b></a><a class="navbar__item navbar__link" href="/SynapseML/docs/about">Docs</a><a class="navbar__item navbar__link" href="/SynapseML/blog">Blog</a><a class="navbar__item navbar__link" href="/SynapseML/videos">Videos</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/SynapseML/docs/next/about">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/SynapseML/docs/next/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit">Next</a></li><li><a class="dropdown__link" href="/SynapseML/docs/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit">0.9.1</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/SynapseML/docs/next/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">Developer Docs</a><ul class="dropdown__menu"><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Python<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/scala/com/microsoft/azure/synapse/ml/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Scala<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle displayOnlyInLargeViewport_Jf15 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_2iFN">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_2iFN">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/SynapseML/"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--light_3ouy navbar__logo"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--dark_3zJb navbar__logo"><b class="navbar__title">SynapseML</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/SynapseML/docs/about">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/SynapseML/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/SynapseML/videos">Videos</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/SynapseML/docs/next/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/SynapseML/docs/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit">0.9.1</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/SynapseML/docs/next/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Developer Docs</a><ul class="menu__list"><li class="menu__list-item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Python<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/scala/com/microsoft/azure/synapse/ml/index.html" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Scala<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item"><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_3zOJ"><aside class="docSidebarContainer_G8MK"><div class="sidebar_1tWv"><nav class="menu menu--responsive thin-scrollbar menu_1Iah menuWithAnnouncementBar_3acx" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_1woU" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/SynapseML/docs/next/about">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/getting_started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/getting_started/first_example">First Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/getting_started/first_model">First Model</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/CognitiveServices - Overview">CognitiveServices - Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">HTTP on Spark</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/http/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/http/HttpOnSpark - Working with Arbitrary Web APIs">HttpOnSpark - Working with Arbitrary Web APIs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">LightGBM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/lightgbm/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/lightgbm/LightGBM - Overview">LightGBM - Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Model Interpretability</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/model_interpretability/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/model_interpretability/ModelInterpretability - Snow Leopard Detection">ModelInterpretability - Snow Leopard Detection</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">ONNX</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/onnx/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/onnx/ONNX - Inference on Spark">ONNX - Inference on Spark</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Spark Serving</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/spark_serving/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/spark_serving/SparkServing - Deploying a Classifier">SparkServing - Deploying a Classifier</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Vowpal Wabbit</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/vw/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/features/vw/Vowpal Wabbit - Overview">Vowpal Wabbit - Overview</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Examples</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/examples/about">About</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/examples/AzureSearchIndex - Met Artworks">AzureSearchIndex - Met Artworks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/examples/ConditionalKNN - Exploring Art Across Cultures">ConditionalKNN - Exploring Art Across Cultures</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/examples/CyberML - Anomalous Access Detection">CyberML - Anomalous Access Detection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/examples/HyperParameterTuning - Fighting Breast Cancer">HyperParameterTuning - Fighting Breast Cancer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/examples/OpenCV - Pipeline Image Transformations">OpenCV - Pipeline Image Transformations</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Classification</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/examples/classification/Classification - Adult Census with Vowpal Wabbit">Classification - Adult Census with Vowpal Wabbit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/examples/classification/Classification - Adult Census">Classification - Adult Census</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/examples/classification/Classification - Before and After SynapseML">Classification - Before and After SynapseML</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/SynapseML/docs/next/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit">Classification - Twitter Sentiment with Vowpal Wabbit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Cognitive Services</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/cognitive_services/CognitiveServices - Celebrity Quote Analysis">CognitiveServices - Celebrity Quote Analysis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/cognitive_services/CognitiveServices - Predictive Maintenance">CognitiveServices - Predictive Maintenance</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Deep Learning</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/deep_learning/DeepLearning - BiLSTM Medical Entity Extraction">DeepLearning - BiLSTM Medical Entity Extraction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/deep_learning/DeepLearning - CIFAR10 Convolutional Network">DeepLearning - CIFAR10 Convolutional Network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/deep_learning/DeepLearning - Flower Image Classification">DeepLearning - Flower Image Classification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/deep_learning/DeepLearning - Transfer Learning">DeepLearning - Transfer Learning</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Model Interpretability</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/model_interpretability/Interpretability - Image Explainers">Interpretability - Image Explainers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/model_interpretability/Interpretability - Tabular SHAP explainer">Interpretability - Tabular SHAP explainer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/model_interpretability/Interpretability - Text Explainers">Interpretability - Text Explainers</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Regression</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/regression/Regression - Auto Imports">Regression - Auto Imports</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/regression/Regression - Flight Delays with DataCleaning">Regression - Flight Delays with DataCleaning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/regression/Regression - Flight Delays">Regression - Flight Delays</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/regression/Regression - Vowpal Wabbit vs. LightGBM vs. Linear Regressor">Regression - Vowpal Wabbit vs. LightGBM vs. Linear Regressor</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Text Analytics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/text_analytics/TextAnalytics - Amazon Book Reviews with Word2Vec">TextAnalytics - Amazon Book Reviews with Word2Vec</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/examples/text_analytics/TextAnalytics - Amazon Book Reviews">TextAnalytics - Amazon Book Reviews</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Transformers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/documentation/transformers/transformers_cognitive">Cognitive</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/documentation/transformers/transformers_core">Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/documentation/transformers/transformers_opencv">OpenCV</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/documentation/transformers/transformers_vw">Vowpal Wabbit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/documentation/transformers/transformers_deep_learning">Deep Learning</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Estimators</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/documentation/estimators/estimators_core">Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/documentation/estimators/estimators_lightgbm">LightGBM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/documentation/estimators/estimators_vw">Vowpal Wabbit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/reference/developer-readme">Build System Commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/reference/contributing_guide">Contributing Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/reference/docker">Docker Image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SynapseML/docs/next/reference/R-setup">R setup</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3Zec"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_2q91"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Synapse ML <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/SynapseML/docs/examples/classification/Classification - Twitter Sentiment with Vowpal Wabbit">latest version</a></b> (0.9.1).</div></div><div class="docItemContainer_37q2"><article><span class="badge badge--secondary">Version: Next</span><div class="markdown"><header><h1 class="h1Heading_2x3C">Twitter Sentiment Classification using Vowpal Wabbit in SynapseML</h1></header><p>In this example, we show how to build a sentiment classification model using Vowpal Wabbit (VW) in SynapseML. The data set we use to train and evaluate the model is <a href="http://help.sentiment140.com/for-students/?source=post_page---------------------------" target="_blank" rel="noopener noreferrer">Sentiment140</a> twitter data. First, we import a few packages that we need.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">import</span><span class="token plain"> os</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> re</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> urllib</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">request</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> numpy </span><span class="token keyword">as</span><span class="token plain"> np</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> pandas </span><span class="token keyword">as</span><span class="token plain"> pd</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> zipfile </span><span class="token keyword">import</span><span class="token plain"> ZipFile</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> bs4 </span><span class="token keyword">import</span><span class="token plain"> BeautifulSoup</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">functions </span><span class="token keyword">import</span><span class="token plain"> udf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> rand</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> when</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> col</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">types </span><span class="token keyword">import</span><span class="token plain"> StructType</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> StructField</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> DoubleType</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> StringType</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ml </span><span class="token keyword">import</span><span class="token plain"> Pipeline</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ml</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">feature </span><span class="token keyword">import</span><span class="token plain"> CountVectorizer</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> RegexTokenizer</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> synapse</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ml</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">vw </span><span class="token keyword">import</span><span class="token plain"> VowpalWabbitClassifier</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> synapse</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ml</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">train </span><span class="token keyword">import</span><span class="token plain"> ComputeModelStatistics</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">mllib</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">evaluation </span><span class="token keyword">import</span><span class="token plain"> BinaryClassificationMetrics</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">pyplot </span><span class="token keyword">as</span><span class="token plain"> plt</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">if</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;AZURE_SERVICE&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;Microsoft.ProjectArcadia&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">sql </span><span class="token keyword">import</span><span class="token plain"> SparkSession</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    spark </span><span class="token operator">=</span><span class="token plain"> SparkSession</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">builder</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">getOrCreate</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:rgb(136, 132, 111)"># URL to download the sentiment140 dataset and data file names</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DATA_URL </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;http://cs.stanford.edu/people/alecmgo/trainingandtestdata.zip&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">TRAIN_FILENAME </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;training.1600000.processed.noemoticon.csv&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">TEST_FILENAME </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;testdata.manual.2009.06.14.csv&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># Folder for storing the downloaded data</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DATA_FOLDER </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;data&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># Data column names</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">COL_NAMES </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;date&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;query_string&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># Text encoding type of the data</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ENCODING </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;iso-8859-1&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1Ezv" id="data-preparation"></a>Data Preparation<a class="hash-link" href="#data-preparation" title="Direct link to heading">#</a></h2><p>We use <a href="http://help.sentiment140.com/for-students/?source=post_page---------------------------" target="_blank" rel="noopener noreferrer">Sentiment140</a> twitter data which originated from a Standford research project to train and evaluate VW classification model on Spark. The same dataset has been used in a previous <a href="https://github.com/Azure-Samples/MachineLearningSamples-TwitterSentimentPrediction" target="_blank" rel="noopener noreferrer">Azure Machine Learning sample</a> on twitter sentiment prediction. Before using the data to build the classification model, we first download and clean up the data.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(166, 226, 46)">download_data</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> data_folder</span><span class="token operator">=</span><span class="token plain">DATA_FOLDER</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> filename</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;downloaded_data.zip&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(230, 219, 116)">&quot;&quot;&quot;Download and extract data from url&quot;&quot;&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    data_dir </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;./&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> DATA_FOLDER</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token keyword">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">data_dir</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">makedirs</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">data_dir</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    downloaded_filepath </span><span class="token operator">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">data_dir</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> filename</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">print</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;Downloading data...&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    urllib</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">urlretrieve</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> downloaded_filepath</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">print</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;Extracting data...&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    zipfile </span><span class="token operator">=</span><span class="token plain"> ZipFile</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">downloaded_filepath</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    zipfile</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">extractall</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">data_dir</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    zipfile</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">print</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;Finished data downloading and extraction.&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">download_data</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">DATA_URL</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>Let&#x27;s read the training data into a Spark DataFrame.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">df_train </span><span class="token operator">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;.&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> DATA_FOLDER</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> TRAIN_FILENAME</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                       header</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> names</span><span class="token operator">=</span><span class="token plain">COL_NAMES</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> encoding</span><span class="token operator">=</span><span class="token plain">ENCODING</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">df_train </span><span class="token operator">=</span><span class="token plain"> spark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">createDataFrame</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">df_train</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> verifySchema</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>We can take a look at the training data and check how many samples it has. We should see that there are 1.6 million samples in the training data. There are 6 fields in the training data:</p><ul><li>label: the sentiment of the tweet (0.0 = negative, 2.0 = neutral, 4.0 = positive)</li><li>id: the id of the tweet</li><li>date: the date of the tweet</li><li>query_string: The query used to extract the data. If there is no query, then this value is NO_QUERY.</li><li>user: the user that tweeted</li><li>text: the text of the tweet</li></ul><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">df_train</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">10</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">toPandas</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">print</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;Number of training samples: &quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> df_train</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>Before training the model, we randomly permute the data to mix negative and positive samples. This is helpful for properly training online learning algorithms like VW. To speed up model training, we use a subset of the data to train the model. If training with the full training set, typically you will see better performance of the model on the test set. </p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">df_train </span><span class="token operator">=</span><span class="token plain"> df_train</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">orderBy</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rand</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> \</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                   </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">100000</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> \</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                   </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">withColumn</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> when</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">col</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(174, 129, 255)">0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(174, 129, 255)">1.0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">otherwise</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">0.0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> \</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                   </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">select</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1Ezv" id="vw-synapseml-training"></a>VW SynapseML Training<a class="hash-link" href="#vw-synapseml-training" title="Direct link to heading">#</a></h2><p>Now we are ready to define a pipeline which consists of feture engineering steps and the VW model.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:rgb(136, 132, 111)"># Specify featurizers</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">tokenizer </span><span class="token operator">=</span><span class="token plain"> RegexTokenizer</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">inputCol</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                           outputCol</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;words&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">count_vectorizer </span><span class="token operator">=</span><span class="token plain"> CountVectorizer</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">inputCol</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;words&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                   outputCol</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;features&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># Define VW classification model</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;--loss_function=logistic --quiet --holdout_off&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">vw_model </span><span class="token operator">=</span><span class="token plain"> VowpalWabbitClassifier</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">featuresCol</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;features&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                  labelCol</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                  args</span><span class="token operator">=</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                  numPasses</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">10</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># Create a pipeline</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">vw_pipeline </span><span class="token operator">=</span><span class="token plain"> Pipeline</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">stages</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token plain">tokenizer</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> count_vectorizer</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> vw_model</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>With the prepared training data, we can fit the model pipeline as follows.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">vw_trained </span><span class="token operator">=</span><span class="token plain"> vw_pipeline</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">df_train</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1Ezv" id="model-performance-evaluation"></a>Model Performance Evaluation<a class="hash-link" href="#model-performance-evaluation" title="Direct link to heading">#</a></h2><p>After training the model, we evaluate the performance of the model using the test set which is manually labeled.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">df_test </span><span class="token operator">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;.&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> DATA_FOLDER</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> TEST_FILENAME</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                       header</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> names</span><span class="token operator">=</span><span class="token plain">COL_NAMES</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> encoding</span><span class="token operator">=</span><span class="token plain">ENCODING</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">df_test </span><span class="token operator">=</span><span class="token plain"> spark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">createDataFrame</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">df_test</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> verifySchema</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>We only use positive and negative tweets in the test set to evaluate the model, since our model is a binary classification model trained with only positive and negative tweets.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">print</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;Number of test samples before filtering: &quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> df_test</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">df_test </span><span class="token operator">=</span><span class="token plain"> df_test</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token builtin" style="color:rgb(174, 129, 255)">filter</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">col</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(174, 129, 255)">2.0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> \</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                 </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">withColumn</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> when</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">col</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(174, 129, 255)">0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(174, 129, 255)">1.0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">otherwise</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">0.0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> \</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                 </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">select</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">print</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;Number of test samples after filtering: &quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> df_test</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:rgb(136, 132, 111)"># Make predictions</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">predictions </span><span class="token operator">=</span><span class="token plain"> vw_trained</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">df_test</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">predictions</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">10</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">toPandas</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:rgb(136, 132, 111)"># Compute model performance metrics</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">metrics </span><span class="token operator">=</span><span class="token plain"> ComputeModelStatistics</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">evaluationMetric</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;classification&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                 labelCol</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                 scoredLabelsCol</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;prediction&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">metrics</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">toPandas</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:rgb(136, 132, 111)"># Utility class for plotting ROC curve (https://stackoverflow.com/questions/52847408/pyspark-extract-roc-curve)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">CurveMetrics</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">BinaryClassificationMetrics</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(166, 226, 46)">__init__</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token builtin" style="color:rgb(174, 129, 255)">super</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">CurveMetrics</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token operator">*</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(166, 226, 46)">get_curve</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        rdd </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(174, 129, 255)">getattr</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">_java_model</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">toJavaRDD</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        points </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword">for</span><span class="token plain"> row </span><span class="token keyword">in</span><span class="token plain"> rdd</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">collect</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            points </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token builtin" style="color:rgb(174, 129, 255)">float</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">row</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">_1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(174, 129, 255)">float</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">row</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">_2</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> points</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">preds </span><span class="token operator">=</span><span class="token plain"> predictions</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">select</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;probability&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> \</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                   </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">rdd</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token builtin" style="color:rgb(174, 129, 255)">map</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token keyword">lambda</span><span class="token plain"> row</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token builtin" style="color:rgb(174, 129, 255)">float</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">row</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;probability&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(174, 129, 255)">float</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">row</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">roc_points </span><span class="token operator">=</span><span class="token plain"> CurveMetrics</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">preds</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">get_curve</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;roc&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># Plot ROC curve</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">fig </span><span class="token operator">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">x_val </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token number" style="color:rgb(174, 129, 255)">0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> x </span><span class="token keyword">in</span><span class="token plain"> roc_points</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">y_val </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> x </span><span class="token keyword">in</span><span class="token plain"> roc_points</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;ROC curve on test set&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;False positive rate&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;True positive rate&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">x_val</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> y_val</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># Use display() if you&#x27;re on Azure Databricks or you can do plt.show()</span><span class="token plain"></span></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>You should see an ROC curve like the following after the above cell is executed. </p><img src="https://user-images.githubusercontent.com/20047467/69376052-9b0a3380-0c77-11ea-9266-11aa44350cbe.png" width="400" height="320"></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/SynapseML/docs/next/examples/classification/Classification - Before and After SynapseML"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Classification - Before and After SynapseML</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/SynapseML/docs/next/examples/cognitive_services/CognitiveServices - Celebrity Quote Analysis"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CognitiveServices - Celebrity Quote Analysis Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_2pwG thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-preparation" class="table-of-contents__link">Data Preparation</a></li><li><a href="#vw-synapseml-training" class="table-of-contents__link">VW SynapseML Training</a></li><li><a href="#model-performance-evaluation" class="table-of-contents__link">Model Performance Evaluation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/installation">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/first_example">Getting Started</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python API Reference</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/scala/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scala API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/videos">Videos</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Microsoft.</div></div></div></footer></div>
<script src="/SynapseML/assets/js/runtime~main.dc74e8c4.js"></script>
<script src="/SynapseML/assets/js/main.1181f347.js"></script>
</body>
</html>